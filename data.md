# Модели данных сервиса служб доставки

Главная настройка которая указывается - это **Город откуда отправляются посылки**

```json
{
  "city_code": "0c5b2444-70a0-4932-980c-b4dc0d3f02b5",
  "city_name": "Москва",
  "region_name": "",
  "short_name": "г"
}
```

Города в поиске:

```json
{
  "shortname": "г",
  "formalname": "Москва",
  "postalcode": "",
  "aoguid": "0c5b2444-70a0-4932-980c-b4dc0d3f02b5",
  "region_name": "Москва г",
  "order_by": 12108257,
  "city_name": "г Москва",
  "full_name": "Москва г"
}
```

## Слжбы доставки

Включают в себя способы доставки данной службы, могут содержать в себе АПИ ключи. А так же дополнительные данные которые необходимо ввести для работы с данной службой

(Возможность изменения отображения названий способов доставки и сортировку)

- Учитывать коммиссию за наложенный платеж при расчете стоимости доставки
- Учитывать комиссию за страховку при расчете стоимости доставки

Так же у каждой службы могут быть свои собственные настройки,
такие как например у Почты России есть галочки "Осторожно" и СМС информирование

## Способ доставки

Способы осуществления доставки определенной службой


Типы способов доставки:

- Курьер
- ПВЗ

**Курьер**

```json
{
  "name": "СДЭК",
  "id": "sdek_posylka_sd",
  "type": "courier",
  "delivery_days": 1,
  "delivery_price": 388,
  "payments": {
    "card": null,
    "cash": true,
    "online": true
  },
  "days_and_price": "<span class=\"sb_product_delivery_days\">1&nbsp;день</span>, <span class=\"sb_product_delivery_price\">388&nbsp;руб.</span>",
  "description": "<span class=\"sb_product_delivery_method\">СДЭК</span> <span class=\"sb_product_delivery_days\">1&nbsp;день</span>, <span class=\"sb_product_delivery_price\">388&nbsp;руб.</span>"
}
```

Доставка курьером. Осуществляется в определенные города.
Т.е состоит из определенных населенных пунктов.
Если в выбранный населенный пункт доставки нет, то данный способ доставки скрывается.

Осуществляется по определенным населенным пунктам (пример г. Москва).

По каждому населенному пункту вводятся данные:

- Населенный пункт
- Стоимость доставки
- Срок (дней)
- Выбор способов оплаты (онлайн, наличными, картой)
- Ограничения по параметрам товара
  - Максимальная длинна (см)
  - Максимальная ширина (см)
  - Максимальная высота (см)
  - Максимальный вес (грамм)
  - Максимальная стоимость (руб)

**ПВЗ**

```json
{
  "name": "Boxberry",
  "id": "boxberry_pvz",
  "type": "pvz|courier|post",
  "delivery_days": 1,
  "delivery_price": 284,
  "payments": {
    "card": false,
    "cash": false,
    "online": true
  },
  "days_and_price": "<span class=\"sb_product_delivery_days\">1&nbsp;день</span>, <span class=\"sb_product_delivery_price\">284&nbsp;руб.</span>",
  "description": "<span class=\"sb_product_delivery_method\">Boxberry</span> <span class=\"sb_product_delivery_days\">1&nbsp;день</span>, <span class=\"sb_product_delivery_price\">284&nbsp;руб.</span>"
}
```

*Что приходит из Boxberry*

```json
{
  "Code": "10.012",
  "Name": "Москва Холодильный_7712_С",
  "CityCode": "68",
  "Address": "115191, Москва г, Холодильный пер, д.3, оф. 37А",
  "Phone": "8-499-391-56-22",
  "WorkShedule": "пн-пт: 11.30-20.30, сб: 12.00-19.00",
  "TripDescription": "Метро \"Тульская\".\nПримерное расстояние от остановки до отделения - 200 м.\nТРЦ \"Ролл Холл\".\nРасположение входа в отделение - центральный вход.\nПавильон 37А.",
  "DeliveryPeriod": 1,
  "CityName": "Москва",
  "TariffZone": "1М",
  "Settlement": "Москва",
  "Area": "Москва",
  "Country": "РОССИЯ",
  "GPS": "55.7083892,37.6254865",
  "AddressReduce": "Холодильный пер, д.3, оф. 37А",
  "Acquiring": "No",
  "DigitalSignature": "No",
  "TypeOfOffice": "СПВЗ",
  "Metro": "Тульская",
  "LoadLimit": "15",
  "VolumeLimit": "0.48",
  "CountryCode": "643",
  "NalKD": "No",
  "OnlyPrepaidOrders": "No"
}
```

*Что приходит из СДЭКа*

```json
{
    "code": "MSK305",
    "name": "Перовский проезд",
    "address_comment": "С правой стороны за магазином «Пятерочка»",
    "nearest_station": "Перовский проезд, д.7",
    "nearest_metro_station": "Авиамоторная",
    "work_time": "Пн-Пт 10:00-20:00, Сб-Вс 10:00-18:00",
    "phones": [
        {
            "number": "+74951981617"
        }
    ],
    "email": "a.nam@cdek.ru",
    "note": "С правой стороны за магазином «Пятерочка»",
    "type": "PVZ",
    "owner_code": "cdek",
    "take_only": false,
    "is_handout": true,
    "is_dressing_room": true,
    "have_cashless": true,
    "have_cash": true,
    "allowed_cod": true,
    "office_image_list": [
        {
            "url": "https://pvzimage.cdek.ru/images/4542/7643_9.jpg"
        },
        {
            "url": "https://pvzimage.cdek.ru/images/4542/7649_13.jpg"
        },
        {
            "url": "https://pvzimage.cdek.ru/images/4542/7645_6.jpg"
        },
        {
            "url": "https://pvzimage.cdek.ru/images/4542/7647_7.jpg"
        },
        {
            "url": "https://pvzimage.cdek.ru/images/4542/7651_5.jpg"
        }
    ],
    "work_time_list": [
        {
            "day": 1,
            "time": "10:00/20:00"
        },
        {
            "day": 2,
            "time": "10:00/20:00"
        },
        {
            "day": 3,
            "time": "10:00/20:00"
        },
        {
            "day": 4,
            "time": "10:00/20:00"
        },
        {
            "day": 5,
            "time": "10:00/20:00"
        },
        {
            "day": 6,
            "time": "10:00/18:00"
        },
        {
            "day": 7,
            "time": "10:00/18:00"
        }
    ],
    "weight_min": 0,
    "weight_max": 35,
    "location": {
        "country_code": "RU",
        "region_code": 81,
        "region": "Москва",
        "city_code": 44,
        "city": "Москва",
        "postal_code": "111024",
        "longitude": 37.703533,
        "latitude": 55.744343,
        "address": "Перовский проезд, 9",
        "address_full": "Россия, Москва, Москва, Перовский проезд, 9"
    },
    "fulfillment": false
}
```

Доставка до пункта выдачи заказов. Состоит из этих самых пунктов выдачи.

Пункты пвз содержат такие данные:

- ID пвз
- Телефон[]
- Населенный пункт
- Улица, дом, корпус/строение
- Стоимость доставки (руб)
- Срок доставки (дней)
- Режим работы (пример: пн-пт 10:00-20:00, сб-вс выходной)
- Ограничения по параметрам товара
  - Максимальная длинна (см)
  - Максимальная ширина (см)
  - Максимальная высота (см)
  - Максимальный вес (грамм)
  - Максимальная стоимость (руб)
- *Порядок сортировки*

```json
{
  "delivery_method_id": "sdek_posylka_ss",
  "delivery_method_name": "СДЭК",
  "id": "MSK234",
  "address": "3-й Хорошевский проезд, 5 строение 1",
  "address_description": "Офисное 3-х этажное здание, между ДСК 1 и автосалоном ГАЗ.  1 этаж. Отдельный вход с 3-го Хорошевского проезда.Над входом вывеска CDEK",
  "city": "Москва",
  "longitude": 37.537805,
  "latitude": 55.77333,
  "metro_id": 1069,
  "type": "pvz|postmat",
  "delivery_days": 1,
  "delivery_price": 278,
  "phone": "+79295250444",
  "postalcode": null,
  "schedule": "Пн-Пт 10:00-20:00, Сб-Вс 10:00-18:00",
  "payments": {
    "online": true,
    "cash": true,
    "card": true
  }
}
```

## Правила, наценки, изменение сроков

Гибкая настройка правил. Правило содержит в себе поля:

- Правило включено (чекбокс)
- Правило изменяет стоимость доставки (чекбокс)
- Тип правила
  - Скидка - значение (руб, процент)
  - Наценка - значение (руб, процент)
  - Фиксированная стоимость (руб, процент)
  - Округление до (10, 50, 100 рублей)
  - Правило изменяет срок доставки
    - Увеличение на n дней
  - Правило блокирует указанные службы доставки
    - Информационное сообщение
  - На что будет действовать данное правило (перечисление, либо исключение)
    - Регионы (московская обл)
    - Населенные пункты (москва г)
    - Способы доставки
    - Пункты самовывоза
    - Промокоды
    - Продукты
  - Применить при стоимости заказа выше или ниже указанной суммы (объявленная ценность)
  - Применить при стоимости заказа больше или меньше указанного веса (грамм)
  - Приоритет правила
  - Применять подходящие правила с меньшим приоритетом
  - Возможные способы оплаты
  - Дополнительное поле

## Промокоды

Можно использовать в правилах

- Промокод
- Способы доставки
- ID пвз
- Блокировать остальные способы доставки

## Расчет стоимости доставки

- Населенный пункт куда осуществляется доставка
- Стоимость к оплате
- Объявленная ценность
- Вес (грамм)
- Размер Х (см)
- Размер Y (см)
- Размер Z (см)
